/// Generator configuration for Prisma Client
generator client {
    provider = "prisma-client-js"
}

/// Database connection configuration
datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

/// User role enumeration for access control
enum UserRole {
    REGULAR  // Regular user with basic platform access
    ADMIN    // Administrator with elevated privileges for platform management
    OWNER    // Platform owner with full system access
}

/// Status tracking for mentorship relationships
enum MentorshipStatus {
    PENDING    // Mentorship request awaiting confirmation
    ACTIVE     // Currently ongoing mentorship
    COMPLETED  // Successfully finished mentorship program
    CANCELED   // Prematurely ended mentorship
}

/// Status for mentorship matching suggestions
enum SuggestionStatus {
    PENDING   // New suggestion awaiting response
    ACCEPTED  // Suggestion approved by both parties
    DECLINED  // Suggestion rejected by either party
}

enum Gender {
    MAN
    WOMAN
    NONBINARY
    TRANSGENDER
    OTHER
}

/// Technical skills for mentorship matching
model Skill {
    id        Int    @id @default(autoincrement())
    name      String
    slug      String
    mentors   User[] @relation("skills_as_mentor")
    mentees   User[] @relation("skills_as_mentee")
}

model SeniorityLevel {
    id        Int      @id @default(autoincrement())
    name      String
    slug      String
    /// Users who have this seniority level as a mentor
    mentors   User[]   @relation("seniority_as_mentor")
    /// Users who have this seniority level as a mentee
    mentees   User[]   @relation("seniority_as_mentee")
}

model Goal {
    id        Int      @id @default(autoincrement())
    name      String
    slug      String
    /// Users who can mentor these goals
    mentors   User[]   @relation("goals_as_mentor")
    /// Users seeking mentorship with this goal
    mentees   User[]   @relation("goals_as_mentee")
}

model SoftSkill {
    id        Int      @id @default(autoincrement())
    name      String
    slug      String
    /// Users who can mentor these goals
    mentors   User[]   @relation("soft_skills_as_mentor")
    /// Users seeking mentorship with this goal
    mentees   User[]   @relation("soft_skills_as_mentee")
}

model Industry {
    id        Int      @id @default(autoincrement())
    name      String
    slug      String
    /// Users who have selected this as one of their industries
    mentors   User[]
}

/// OAuth account information for NextAuth.js
model Account {
    id                       String  @id @default(cuid())
    userId                   String
    type                     String
    provider                 String
    providerAccountId        String
    refresh_token            String?
    access_token             String?
    expires_at               Int?
    token_type               String?
    scope                    String?
    id_token                 String?
    session_state            String?
    user                     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
    refresh_token_expires_in Int?

    @@unique([provider, providerAccountId])
}

/// User session management for NextAuth.js
model Session {
    id           String   @id @default(cuid())
    sessionToken String   @unique
    userId       String
    expires      DateTime
    /// Related user record
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

/// Core user model containing profile and relationship data
model User {
    id                    String     @id @default(cuid())
    name                  String?
    email                 String?    @unique
    emailVerified         DateTime?
    image                 String?
    title                 String?
    location              String?
    in_person             Boolean?
    about                 String?
    role                  UserRole   @default(REGULAR)
    linkedin_url          String?
    availability          Json?
    notificationPreferences Json?
    onboardingCompletedAt DateTime?

    accounts              Account[]
    sessions              Session[]
    /// Skills user can mentor others in
    mentor_skills         Skill[]    @relation("skills_as_mentor")
    /// Skills user wants to learn
    mentee_skills         Skill[]    @relation("skills_as_mentee")
    /// Mentorships where user is the mentor
    mentor_mentorships    Mentorship[] @relation("mentor_mentorships")
    /// Mentorships where user is the mentee
    mentee_mentorships    Mentorship[] @relation("mentee_mentorships")
    /// Messages sent by this user
    sent_messages         Message[]    @relation("sent_messages")
    /// Messages received by this user
    received_messages     Message[]    @relation("received_messages")
    /// Suggestions where user is the mentor
    suggested_mentor      Suggestion[] @relation("suggested_mentor")
    /// Suggestions where user is the mentee
    suggested_mentee      Suggestion[] @relation("suggested_mentee")
    /// Conversations where user is participant1
    participant1_conversations Conversation[] @relation("participant1_conversations")
    /// Conversations where user is participant2
    participant2_conversations Conversation[] @relation("participant2_conversations")
    /// Is this user actively looking for mentees
    active_mentor         Boolean @default(false)
    /// Is this user actively looking to be mentored
    active_mentee         Boolean @default(false)
    /// Number of mentees user can accept
    mentor_capacity       Int?
    /// Gender of user
    mentor_gender         Gender?
    /// Gender user wants mentorship from (empty = any)
    mentee_gender         Gender[]
    /// Goals that the user can help mentees with
    mentor_goals          Goal[] @relation("goals_as_mentor")
    /// Goals that the user wants mentorship for
    mentee_goals          Goal[] @relation("goals_as_mentee")
    /// Users seniority level as a mentor
    mentor_seniority_id   Int?
    mentor_seniority      SeniorityLevel? @relation("seniority_as_mentor", fields: [mentor_seniority_id], references: [id])
    /// Users seniority level as a mentee
    mentee_seniority_id   Int?
    mentee_seniority      SeniorityLevel? @relation("seniority_as_mentee", fields: [mentee_seniority_id], references: [id])
    /// Goals that the user can help mentees with
    mentor_soft_skills    SoftSkill[] @relation("soft_skills_as_mentor")
    /// Goals that the user wants mentorship for
    mentee_soft_skills    SoftSkill[] @relation("soft_skills_as_mentee")
    /// 2-3 sentences about the user
    bio                   String?
    /// Short text
    motivation            String?
    /// Industry that user has the most experiene in
    industry              Industry[]
    /// Discription of side projects
    side_projects         String?
}

/// Verification tokens for passwordless authentication
model VerificationToken {
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}

/// Mentorship relationship tracking
model Mentorship {
    id              String           @id @default(cuid())
    mentorId        String
    menteeId        String
    startDate       DateTime
    endDate         DateTime?
    status          MentorshipStatus @default(PENDING)
    goals           Json?
    notes           String?

    mentor          User             @relation("mentor_mentorships", fields: [mentorId], references: [id])
    mentee          User             @relation("mentee_mentorships", fields: [menteeId], references: [id])
    messages        Message[]        @relation("mentorship_messages")
    meetings        Meeting[]        @relation("mentorship_meetings")
}

/// Communication messages between users
model Message {
    id            String    @id @default(cuid())
    mentorshipId  String?
    conversationId String?
    senderId      String
    receiverId    String
    content       String
    sentAt        DateTime  @default(now())

    mentorship    Mentorship? @relation("mentorship_messages", fields: [mentorshipId], references: [id], onDelete: Cascade)
    conversation  Conversation? @relation("conversation_messages", fields: [conversationId], references: [id], onDelete: Cascade)
    sender        User       @relation("sent_messages", fields: [senderId], references: [id], onDelete: Cascade)
    receiver      User       @relation("received_messages", fields: [receiverId], references: [id], onDelete: Cascade)
}

/// Mentorship matching suggestions
model Suggestion {
    id          String           @id @default(cuid())
    mentorId    String
    menteeId    String
    status      SuggestionStatus @default(PENDING)

    mentor      User             @relation("suggested_mentor", fields: [mentorId], references: [id])
    mentee      User             @relation("suggested_mentee", fields: [menteeId], references: [id])
}

/// Conversation model for user interactions
model Conversation {
    id              String    @id @default(cuid())
    participant1Id  String
    participant2Id  String
    messages        Message[] @relation("conversation_messages")

    participant1    User     @relation("participant1_conversations", fields: [participant1Id], references: [id])
    participant2    User     @relation("participant2_conversations", fields: [participant2Id], references: [id])
}

/// Meeting details for scheduled mentorship sessions
model Meeting {
    id              String     @id @default(cuid())
    mentorshipId    String
    scheduledAt     DateTime
    duration        Int        // Duration in minutes
    location        String?    // Optional location or link for the meeting
    notes           String?    // Optional notes for the meeting

    mentorship      Mentorship @relation("mentorship_meetings", fields: [mentorshipId], references: [id], onDelete: Cascade)
}
